<ul class="breadcrumb">
  <li><a href="/">Home</a><span class="divider">»</span></li>
  <li><a href="/trackers">Projects</a><span class="divider">»</span></li>
  <li><a ng-href="/trackers/{{issue.tracker.slug}}">{{issue.tracker.name || 'Loading...'}}</a><span class="divider">»</span></li>
  <li><a ng-href="/issues/{{issue.slug}}">{{issue.title ||'Loading...'}}</a></li>
</ul>

<div class="row-fluid" ng-show="issue">
  <div class="span9">
    <div ng-include="'pages/issues/partials/header.html'"></div>
    <div ng-include="'pages/issues/partials/nav_tabs.html'"></div>
    <div ng-include="'pages/issues/partials/my_solution_box.html'"></div>

    <!-- Discrete button to add new claim, for when there are others present -->
    <div collapse="show_new_claim_form" ng-hide="issue.bounty_claims.length <= 0">
      <button class="btn btn-small" style="margin-bottom: 10px; float: right;" ng-click-require-auth="show_new_dispute_form = !show_new_dispute_form">Submit your own Claim</button>
    </div>

    <!-- Massive form for a new claim if there aren't any yet -->
    <div class="hero-unit" ng-show="issue.bounty_claims.length <= 0">
      <h2 style="margin-top: 0;">Claim the Bounty!</h2>
      <form class="form-horizontal" name="form_data" ng-submit="bounty_claim_submit()">
        <p>
          If your claim goes undisputed for two weeks, you will be awarded the {{issue.bounty_total | dollars}} bounty.
          If your solution is unanimously accepted by the backers of the issue, you will instead be awarded the bounty immediately.
        </p>
        <div class="control-group">
          <label class="control-label" for="code_url">Code URL</label>
          <div class="controls">
            <input class="span12" id="code_url" name="code_url" type="url" ng-model="new_bounty_claim.code_url" placeholder="The URL to your solution. For example, a pull request on GitHub" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="description">Description</label>
          <div class="controls">
            <textarea class="span12" id="description" name="description" ng-model="new_bounty_claim.description" rows="3" placeholder="A description of how you resolved the issue."></textarea>
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-primary" ng-disabled="!new_bounty_claim.code_url && !new_bounty_claim.description">Claim the Bounty</button>
          </div>
        </div>
      </form>
    </div>

    <!-- Submit bounty claim form -->
    <div collapse="!show_new_claim_form">
      <div class="well" ng-hide="issue.my_bounty_claim || issue.accepted_bounty_claim">
        <form class="form-horizontal" name="form_data" ng-submit="bounty_claim_submit()">
          <p>
            If your claim goes undisputed for two weeks, you will be awarded the {{issue.bounty_total | dollars}} bounty.
            If your solution is unanimously accepted by the backers of the issue, you will instead be awarded the bounty immediately.
          </p>
          <div class="control-group">
            <label class="control-label" for="code_url">Code URL</label>
            <div class="controls">
              <input class="span12" id="code_url" name="code_url" type="url" ng-model="new_bounty_claim.code_url" placeholder="The URL to your solution. For example, a pull request on GitHub" />
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="description">Description</label>
            <div class="controls">
              <textarea class="span12" id="description" name="description" ng-model="new_bounty_claim.description" rows="3" placeholder="A description of how you resolved the issue."></textarea>
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <button type="submit" class="btn btn-primary" ng-disabled="!new_bounty_claim.code_url && !new_bounty_claim.description">Claim the Bounty</button>
              <button type="submit" class="btn" ng-click="show_new_claim_form = false">Cancel</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="row-fluid" ng-repeat="claim in issue.bounty_claims" style="margin-bottom: 25px;">
      <div class="span2">
        <!-- Developer image -->
        <div>
          <a class="thumbnail" ng-href="/people/{{claim.person.slug}}">
            <img style="width: 100%;" ng-src="{{claim.person.medium_image_url}}" />
          </a>
        </div>

        <!-- Code submission button -->
        <div ng-show="claim.code_url" style="margin: 10px 0;">
          <a class="btn btn-block btn-small" ng-href="{{claim.code_url}}" target="_blank"><i class="icon-globe"></i> View Code</a>
        </div>

        <!-- Accept/Reject buttons -->
        <div class="row-fluid" ng-show="(!issue.my_bounty_claim || claim.id != issue.my_bounty_claim.id) && issue.can_respond_to_claims && claim.in_dispute_period" style="margin: 10px 0;">
          <div class="span6">
            <button class="btn btn-block btn-small btn-success" ng-class="{ active: (claim.$my_response == true) }" ng-click="claim.accept()"><i class="icon-thumbs-up icon-white"></i> Accept</button>
          </div>
          <div class="span6">
            <button class="btn btn-block btn-small btn-danger" ng-class="{ active: (claim.$my_response == false) }" ng-click="claim.reject()"><i class="icon-thumbs-down icon-white"></i> Reject</button>
          </div>
        </div>

        <!-- Retract claim button, if it's yours -->
        <div ng-show="issue.my_bounty_claim && claim.id == issue.my_bounty_claim.id" style="margin: 10px 0;">
          <button class="btn btn-small btn-block btn-danger" ng-click="claim.destroy()"><i class="icon-trash icon-white"></i> Retract Claim</button>
        </div>

        <!-- Vote count -->
        <p class="text-center">Votes: <strong class="text-success">{{claim.accept_count | number}}</strong> of <strong>{{claim.backers_count | number}}</strong></p>
      </div>
      <div class="span10">
        <!-- Title for claims from other developers -->
        <h4 ng-show="!issue.my_bounty_claim || claim.id != issue.my_bounty_claim.id" style="margin: 0;">Claim by <a ng-href="/people/{{claim.person.slug}}">{{claim.person.display_name}}</a></h4>

        <!-- Title for your own claim -->
        <h4 ng-show="issue.my_bounty_claim && claim.id == issue.my_bounty_claim.id" style="margin: 0;">Your claim</h4>

        <div><span class="label label-warning" ng-show="claim.reject_count >= 1">Claim Disputed</span></div>
        <p class="muted">submitted {{claim.created_at | date}}</p>
        <div ng-show="claim.description">
          <p class="well well-small" style="white-space: pre-wrap;">{{claim.description}}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="span3">
    <div ng-include="'pages/issues/partials/bounty_box.html'"></div>
    <div ng-include="'pages/issues/partials/claim_info_box.html'"></div>
    <div ng-include="'pages/issues/partials/developer_box.html'"></div>
  </div>
</div>
